<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wave Pongruengkiat</title>
<meta name="description" content="Interactive art, creative technology, immersive experiences. Based in Chiang Mai, Thailand.">
<link rel="stylesheet" href="assets/css/style.css">
</head>
<body>

<!-- NAVIGATION -->
<nav class="nav">
  <div class="nav-inner">
    <a href="index.html" class="nav-logo">Wave Pongruengkiat</a>
    <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')" aria-label="Menu">&#9776;</button>
    <div class="nav-links">
      <a href="index.html" class="active">Work</a>
      <a href="archive.html">Archive</a>
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
    </div>
  </div>
</nav>

<!-- HERO — full-screen with zoom-in background image -->
<!-- To change hero image: replace the URL below with a Google Drive or direct image URL -->
<section class="hero">
  <div class="hero-bg" style="background-image: url('assets/img/hero.jpg')"></div>
  <div class="hero-overlay"></div>
  <div class="hero-content">
    <h1>Wave Pongruengkiat</h1>
    <p class="subtitle">Interactive Art &amp; Creative Technology</p>
    <p class="subtitle-location">Chiang Mai, Thailand</p>
  </div>
</section>

<!-- FEATURED PROJECTS — synced from Google Sheet -->
<section class="featured-section" id="featured-section">
  <div class="featured-grid" id="featured-grid">
    <!-- JS fills this from the spreadsheet (Featured column = yes) -->
    <!-- Fallback: hardcoded cards rendered if fetch fails -->
  </div>
  <div class="view-all">
    <a href="archive.html">View full archive &rarr;</a>
  </div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <div class="container footer-inner">
    <p>&copy; 2026 Wave Pongruengkiat</p>
    <div class="footer-links">
      <a href="about.html">About</a>
      <a href="contact.html">Contact</a>
      <a href="https://github.com/wvweeratouch">GitHub</a>
    </div>
  </div>
</footer>

<script>
(function() {
  var CSV_URL = 'https://docs.google.com/spreadsheets/d/1OpPXBFGI8v8u7fNN7ZChY0PNXhpKvT8ol6tFNYVpsu0/gviz/tq?tqx=out:csv&sheet=projects';

  // Featured project → detail page mapping
  var PAGES = [
    { match: 'ceing', href: 'projects/ceing.html' },
    { match: 'khwan', href: 'projects/khwan-dance.html' },
    { match: 'zer01ne', href: 'projects/zer0ne.html' },
    { match: 'zer0ne', href: 'projects/zer0ne.html' },
    { match: 'technobiological', href: 'projects/technobiological.html' },
    { match: 'data mask', href: 'projects/data-mask.html' },
    { match: 'posthuman', href: 'projects/data-mask.html' },
    { match: 'kong', href: 'projects/kong.html' }
  ];

  var PALETTE = [
    ['#0a1628', '#0d2847', '#22d3ee'],
    ['#1a0a1e', '#2d1035', '#f472b6'],
    ['#1a1008', '#2d1d0a', '#fb923c'],
    ['#0f0a1e', '#1a1035', '#a78bfa'],
    ['#0a1428', '#0d2040', '#60a5fa'],
    ['#0a1a10', '#0d2d18', '#4ade80'],
    ['#1a1010', '#2d1a1a', '#f87171'],
    ['#1a1508', '#2d260a', '#fbbf24']
  ];

  function hashStr(s) {
    var h = 0;
    for (var i = 0; i < s.length; i++) h = ((h << 5) - h + s.charCodeAt(i)) | 0;
    return Math.abs(h);
  }

  function parseCSV(text) {
    var rows = [], row = [], field = '', inQuotes = false;
    for (var i = 0; i < text.length; i++) {
      var c = text[i];
      if (inQuotes) {
        if (c === '"') {
          if (i + 1 < text.length && text[i + 1] === '"') { field += '"'; i++; }
          else inQuotes = false;
        } else field += c;
      } else {
        if (c === '"') inQuotes = true;
        else if (c === ',') { row.push(field.trim()); field = ''; }
        else if (c === '\n' || (c === '\r' && text[i + 1] === '\n')) {
          row.push(field.trim()); field = '';
          if (row.length > 1 || row[0] !== '') rows.push(row);
          row = [];
          if (c === '\r') i++;
        } else field += c;
      }
    }
    row.push(field.trim());
    if (row.length > 1 || row[0] !== '') rows.push(row);
    return rows;
  }

  function findCol(headers, patterns) {
    for (var p = 0; p < patterns.length; p++) {
      var pat = patterns[p].toLowerCase();
      for (var i = 0; i < headers.length; i++) {
        if (headers[i].toLowerCase().indexOf(pat) !== -1) return i;
      }
    }
    return -1;
  }

  function driveToImage(url) {
    if (!url) return '';
    var m = url.match(/\/d\/([a-zA-Z0-9_-]+)/);
    if (m) return 'https://lh3.googleusercontent.com/d/' + m[1] + '=s800';
    if (url.match(/^https?:\/\/.+\.(jpg|jpeg|png|gif|webp)/i)) return url;
    return url;
  }

  function getPage(title) {
    var t = title.toLowerCase();
    for (var i = 0; i < PAGES.length; i++) {
      if (t.indexOf(PAGES[i].match) !== -1) return PAGES[i].href;
    }
    return '';
  }

  function esc(s) {
    return s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
  }

  function renderCard(p) {
    var link = getPage(p.title);
    var tag = link ? 'a' : 'div';
    var href = link ? ' href="' + esc(link) + '"' : '';
    var img = driveToImage(p.image);
    var idx = hashStr(p.title + (p.type || '')) % PALETTE.length;
    var c = PALETTE[idx];
    var gradient = 'linear-gradient(135deg, ' + c[0] + ' 0%, ' + c[1] + ' 30%, ' + c[2] + ' 100%)';

    var visual;
    if (img) {
      visual = '<div class="featured-card-img"><div class="featured-card-visual" style="background-image:url(\'' + esc(img) + '\')"></div></div>';
    } else {
      visual = '<div class="featured-card-img"><div class="featured-card-visual" style="background:' + gradient + '"></div></div>';
    }

    var type = p.type || '';
    var meta = [];
    if (type) meta.push(esc(type));
    if (p.city) meta.push(esc(p.city));
    if (p.year) meta.push(esc(p.year));

    return '<' + tag + ' class="featured-card"' + href + '>' +
      visual +
      '<div class="featured-card-body">' +
      '<h3>' + esc(p.title) + '</h3>' +
      (meta.length ? '<p>' + meta.join(', ') + '</p>' : '') +
      '</div></' + tag + '>';
  }

  function init() {
    var grid = document.getElementById('featured-grid');

    fetch(CSV_URL)
      .then(function(r) { if (!r.ok) throw new Error(r.status); return r.text(); })
      .then(function(text) {
        var rows = parseCSV(text);
        if (rows.length < 2) throw new Error('empty');
        var headers = rows[0];

        var colTitle    = findCol(headers, ['title', 'project name']);
        var colYear     = findCol(headers, ['year']);
        var colType     = findCol(headers, ['type of work', 'type']);
        var colCity     = findCol(headers, ['city']);
        var colCountry  = findCol(headers, ['country']);
        var colImage    = findCol(headers, ['image url', 'image']);
        var colFeatured = findCol(headers, ['featured', 'highlight']);
        if (colTitle === -1) colTitle = 4;

        var featured = [];
        for (var i = 1; i < rows.length; i++) {
          var r = rows[i];
          var title = r[colTitle] || '';
          if (!title) continue;

          // Check featured column (yes/TRUE/1/checked)
          var isFeatured = false;
          if (colFeatured >= 0) {
            var val = (r[colFeatured] || '').toLowerCase().trim();
            isFeatured = val === 'yes' || val === 'true' || val === '1' || val === 'x';
          }
          // Fallback: if no Featured column exists, use projects that have detail pages
          if (colFeatured === -1) {
            isFeatured = !!getPage(title);
          }
          if (!isFeatured) continue;

          featured.push({
            title: title,
            year: r[colYear] || '',
            type: (colType >= 0 ? r[colType] : '') || '',
            city: (colCity >= 0 ? r[colCity] : '') || '',
            country: (colCountry >= 0 ? r[colCountry] : '') || '',
            image: (colImage >= 0 ? r[colImage] : '') || ''
          });
        }

        // Limit to 6 max
        if (featured.length > 6) featured = featured.slice(0, 6);

        if (featured.length > 0) {
          var html = '';
          for (var j = 0; j < featured.length; j++) html += renderCard(featured[j]);
          grid.innerHTML = html;
        } else {
          renderFallback();
        }
      })
      .catch(function() {
        renderFallback();
      });
  }

  // Hardcoded fallback (works offline / local file://)
  function renderFallback() {
    var grid = document.getElementById('featured-grid');
    var fallback = [
      { title: 'CEING Experiment', type: 'Interactive Installation', year: '2025', href: 'projects/ceing.html', gradient: 'linear-gradient(135deg, #0a1628 0%, #0d2847 30%, #22d3ee 100%)' },
      { title: 'Khwan Dance', type: 'Performance', year: 'Korea ACC', href: 'projects/khwan-dance.html', gradient: 'linear-gradient(135deg, #1a0a1e 0%, #2d1035 30%, #f472b6 100%)' },
      { title: 'Kong Interactive', type: 'Installation', year: '179 iterations', href: 'projects/kong.html', gradient: 'linear-gradient(135deg, #1a1008 0%, #2d1d0a 30%, #fb923c 100%)' },
      { title: 'ZER0NE', type: 'Art Residency', year: 'Korea', href: 'projects/zer0ne.html', gradient: 'linear-gradient(135deg, #0f0a1e 0%, #1a1035 30%, #a78bfa 100%)' },
      { title: 'Data Mask', type: 'Interactive Installation', year: 'CMDW', href: 'projects/data-mask.html', gradient: 'linear-gradient(135deg, #0a1428 0%, #0d2040 30%, #60a5fa 100%)' },
      { title: 'Technobiological Futures', type: 'Research', year: '2026–2027', href: 'projects/technobiological.html', gradient: 'linear-gradient(135deg, #0a1a10 0%, #0d2d18 30%, #4ade80 100%)' }
    ];
    var html = '';
    for (var i = 0; i < fallback.length; i++) {
      var f = fallback[i];
      html += '<a class="featured-card" href="' + f.href + '">' +
        '<div class="featured-card-img"><div class="featured-card-visual" style="background:' + f.gradient + '"></div></div>' +
        '<div class="featured-card-body"><h3>' + f.title + '</h3><p>' + f.type + ', ' + f.year + '</p></div></a>';
    }
    grid.innerHTML = html;
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>

</body>
</html>
